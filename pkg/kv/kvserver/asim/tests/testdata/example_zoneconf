# This example configures zone constraints to favor the US_East region. As a
# result, we are expecting that most replicas will be appropriately rebalanced
# across stores=(1-12) which are located in the US. Number of replicas assigned
# to other stores are expected to be approximately zero.

load_cluster config=multi_region
----

# Create 200 ranges (RF=3) with zone preference set to US_East.
set_span_config delay=1m
[0,10000): num_replicas=3 constraints={'+region=US_East'}
----

assertion type=conformance under=0 violating=0
----

gen_ranges ranges=200
----

eval duration=10m samples=1 seed=42
----
OK

plot stat=replicas
----
----

 52.00 ┤                ╭╮─╭──╭╭───────────────────────────────────────────────────────
 48.53 ┤           ╭╭──╭───────────────────────────────────────────────────────────────
 45.07 ┤           ││╯╭╯╯╯
 41.60 ┤          ╭╭──╯
 38.13 ┤         ╭╭│
 34.67 ┤         ╭╭╯
 31.20 ┤         ││
 27.73 ┤        ╭╭╯
 24.27 ┤        ╭╯
 20.80 ┤        │╯
 17.33 ┼────────╮╮
 13.87 ┤       ╰│╮╮
 10.40 ┤        ╰╮─╮
  6.93 ┤         ╰─╮╮╮╮
  3.47 ┤         ╰╰╰─────╮──╮╮
  0.00 ┤          ╰╰─╰───╰─────────────────────────────────────────────────────────────
                                            replicas
----
----
